name: Build NextWM

on: [push, pull_request]
jobs:
    build:
        name: "Build NextWM"
        runs-on: ubuntu-latest
        container:
            image: archlinux
        steps:
            - name: Get required pacman pkgs
              run: |
                  sed -i 's/SigLevel    = Required DatabaseOptional/SigLevel    = Optional TrustAll/' /etc/pacman.conf
                  pacman --noconfirm --noprogressbar -Syyu
                  pacman --noconfirm --noprogressbar -Sy wlroots wayland wayland-protocols xorg-xwayland zig make git pkgconf scdoc clang rustup go
                  rustup install stable
                  rustup default stable

            - name: Checkout NextWM
              uses: actions/checkout@v2
              with:
                  submodules: true

            - name: Install go-wayland-scanner
              run: |
                  cd /tmp
                  git clone https://github.com/rajveermalviya/go-wayland/
                  cd go-wayland
                  go build ./cmd/go-wayland-scanner
                  mv ./go-wayland-scanner /usr/bin

            - name: Build NextWM
              run: |
                  make

            - name: Build Nextctl-rs
              run: |
                  make -C ./nextctl-rs

            - name: Build Nextctl-go
              run: |
                  make BUILD_FLAGS="-buildvcs=false" -C ./nextctl-go

            - name: Formatting Check
              run: |
                  make check
