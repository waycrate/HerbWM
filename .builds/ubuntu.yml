image: ubuntu/jammy
packages:
    - cargo
    - rustfmt
    - clang-format
    - git
    - libwayland-dev
    - golang
    - libwlroots-dev
    - make
    - pkgconf
    - scdoc
    - wayland-protocols
    - xwayland
sources:
    - https://git.sr.ht/~shinyzenith/NextWM
tasks:
    - install-lang: |
          ZIG_VERSION=0.9.1

          wget -nv https://ziglang.org/download/$ZIG_VERSION/zig-linux-x86_64-$ZIG_VERSION.tar.xz
          tar -xvf zig-linux-x86_64-$ZIG_VERSION.tar.xz
          sudo mv ./zig-linux-x86_64-$ZIG_VERSION/zig /usr/bin
          sudo mv ./zig-linux-x86_64-$ZIG_VERSION/lib /usr/lib/zig

    - install_go_wayland_scanner: |
          git clone https://github.com/rajveermalviya/go-wayland
          cd go-wayland
          go build ./cmd/go-wayland-scanner/
          sudo mv ./go-wayland-scanner /usr/bin

    - build: |
          make -C NextWM

    - build-rs: |
          make -C NextWM/nextctl-rs

    - build-go: |
          make -C NextWM/nextctl-go

    - fmt: |
          make check -C NextWM
